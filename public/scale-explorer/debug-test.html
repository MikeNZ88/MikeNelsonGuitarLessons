<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scale Calculation Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #333; }
        .pass { border-color: #4CAF50; background: #1a3e1a; }
        .fail { border-color: #f44336; background: #3e1a1a; }
        pre { background: #2a2a2a; padding: 10px; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>üéµ Scale Calculation Debug Tool</h1>
    <div id="output"></div>

    <!-- Load all the music theory modules -->
    <script src="js/core/constants.js"></script>
    <script src="js/core/color-utils.js"></script>
    <script src="js/core/interval-utils-new.js"></script>
    <script src="js/core/pattern-detection.js"></script>
    <script src="js/core/scale-calculator.js"></script>
    <script src="js/core/chord-analyzer.js"></script>
    <script src="js/core/music-theory.js"></script>

    <script>
        function debugTest(key, expectedScale) {
            const majorFormula = [2, 2, 1, 2, 2, 2, 1];
            
            // Wait for modules to load
            setTimeout(() => {
                try {
                    console.log(`Testing ${key} major scale...`);
                    console.log('MusicTheory available:', !!window.MusicTheory);
                    console.log('calculateScale function:', typeof window.MusicTheory?.calculateScale);
                    
                    if (window.MusicTheory && window.MusicTheory.calculateScale) {
                        const actualScale = window.MusicTheory.calculateScale(key, majorFormula, 'major');
                        console.log(`${key} Major - Expected:`, expectedScale);
                        console.log(`${key} Major - Actual:`, actualScale);
                        
                        const match = JSON.stringify(actualScale) === JSON.stringify(expectedScale);
                        
                        const div = document.createElement('div');
                        div.className = `test ${match ? 'pass' : 'fail'}`;
                        div.innerHTML = `
                            <h3>${key} Major Scale ${match ? '‚úÖ PASS' : '‚ùå FAIL'}</h3>
                            <strong>Expected:</strong> <pre>${JSON.stringify(expectedScale, null, 2)}</pre>
                            <strong>Actual:</strong> <pre>${JSON.stringify(actualScale, null, 2)}</pre>
                            ${!match ? `<strong>Difference:</strong> <pre>${findDifferences(expectedScale, actualScale)}</pre>` : ''}
                        `;
                        document.getElementById('output').appendChild(div);
                    } else {
                        console.error('MusicTheory.calculateScale not available');
                        const div = document.createElement('div');
                        div.className = 'test fail';
                        div.innerHTML = `<h3>${key} Major Scale ‚ùå ERROR</h3><p>MusicTheory.calculateScale not available</p>`;
                        document.getElementById('output').appendChild(div);
                    }
                } catch (error) {
                    console.error(`Error testing ${key}:`, error);
                    const div = document.createElement('div');
                    div.className = 'test fail';
                    div.innerHTML = `<h3>${key} Major Scale ‚ùå ERROR</h3><p>${error.message}</p>`;
                    document.getElementById('output').appendChild(div);
                }
            }, 1000); // Give modules time to load
        }

        function findDifferences(expected, actual) {
            const differences = [];
            const maxLength = Math.max(expected.length, actual.length);
            
            for (let i = 0; i < maxLength; i++) {
                if (expected[i] !== actual[i]) {
                    differences.push(`Index ${i}: expected "${expected[i]}" but got "${actual[i]}"`);
                }
            }
            
            return differences.join('\n');
        }

        // Test cases from our failing tests
        const testCases = [
            { key: 'C', expected: ['C', 'D', 'E', 'F', 'G', 'A', 'B'] },
            { key: 'G', expected: ['G', 'A', 'B', 'C', 'D', 'E', 'F‚ôØ'] },
            { key: 'D', expected: ['D', 'E', 'F‚ôØ', 'G', 'A', 'B', 'C‚ôØ'] },
            { key: 'F', expected: ['F', 'G', 'A', 'B‚ô≠', 'C', 'D', 'E'] },
            { key: 'B‚ô≠', expected: ['B‚ô≠', 'C', 'D', 'E‚ô≠', 'F', 'G', 'A'] }
        ];

        // Run tests after page loads
        window.addEventListener('load', () => {
            testCases.forEach(testCase => {
                debugTest(testCase.key, testCase.expected);
            });
        });
    </script>
</body>
</html> 